# 責務駆動設計

## 2.1 見て、記述して、設計するためのプロセス
ソフトウェアの設計は、実際には順序立って進むようなことは殆ど無い。非常に流動的で臨機応変なもの。必要に応じて作業の順番は変わる。

### 2.1.1 製作を開始する：プロジェクトの定義と計画
本格的な開発の前に。プロジェクトの目的・達成するための計画を策定しましょう。例えば以下。
* ソフトウェア開発の方法
* プロジェクトとプロジェクト関係者にとっての重要な価値
* プロジェクト関係者とその役割・プロセス・期待される成果
* 期待される納品物

### 2.1.2 舞台を準備する：初期の記述
例えばこんな作業をします

#### システム定義フェーズ
* アーキテクチャやシステムの境界、概念などを表す図を作ってみる
* システム概念を説明するために、用語集を作る
* システムの責務を考えるために、システムの機能・使用法などをドキュメント化する

#### システム記述フェーズ
* 開発環境を決める。フレームワークの使用、API、その他ツールなど。
* ユーザーがアプリケーションを具体的にどのように使うかを想定する
* 設計に影響する、アプリケーションに求められる条件などをまとめる。
    * 要求スペック
    * レガシーなデータへの対応
    * 耐障害性、信頼性、etc...
* アクティビティ図などを描いて、システムの動作を文章化する
* 画面仕様書やナビゲーションモデルなどを書いてみる

#### オブジェクト分析フェーズ
* CRCカードを作ったりオブジェクトモデルのたたき台などを作り、ドメイン寄りにオブジェクトを考える。また、オブジェクトの責務についても考える。
* 用語集に再度追加したり、アプリケーションの振る舞いを記述してみることで、初期から追加された概念と用語を文書化する。


また、ユーザー・利害関係者の以下のような欲求を考慮すると、よりよい設計をするための取れる手段が限られてくる。
* 使用法
* 性能
* 構成
* 認証
* 並行性
* スケーラビリティ
* セキュリティ
* 信頼性


### 2.1.3 製作を準備する：設計
初期設計を作成するフェーズと、設計を洗練させるフェーズと分けると良さそう

P.56,57の図を参照して、どういうことをするかみてみよう


### 2.1.4 複数の観点から「観る」
企画や営業などの利害関係者が何に感心を持っていて何を要求しているか、正しく解釈し、
その上で、エンジニア以外の人でも理解できるように、設計を表現してみることが重要。
* ユーザーはアプリケーションがどういう風に役立つか知りたい
* 業務分析者(企画さん？)はポリシーやルール、業務のプロセスが明確に守られているか知りたい
* テスト担当者は、期待するスペックや目標とする使いやすさが満たされているか知りたい

## 2.2 台本を書く：分析の記述
設計の目標の1つは、曖昧なものを明らかにし、ソフトウェアの責務をまとめること。  
こうすることで、ソフトウェアが果たすべき機能をわかりやすくする。

### 2.2.1 使用法の記述

・ソフトウェアを使う側にいる人やものを考える。これをアクター(actor)と呼ぶ。
* ユーザー
* 管理者
* 外部のプログラムやデバイス


・システムがどのように使用されるか、ユースケースを考える。ユースケースは以下の3要素で成り立つ
* 散文：システムがどのように使用されるかを、簡単な文章でまとめる
* シナリオ：システムがどのように使用されるかを、番号付きのステップで構成する
* 会話：ユーザーとシステム間でどのような対話が行われているか
 
例：「文書をファイルに保存する」の散文 → 参考書のコレジャナイ感ハンパないので一旦飛ばし
例： ブログのePub機能の散文化
> ブログ記事に表紙や目次を付け装飾を加えることで、電子書籍として読める。ePub化したブログ記事はブラウザでも読めるし、端末に記事データをダウンロードすることで、電子書籍リーダーでも読める。

例：「文書をHTMLファイルとして保存する」のシナリオ
1. ユーザーがソフトウェアにファイルを保存することを指示する
2. ソフトウェアは「ファイル保存」のダイアログボックスを表示する。
3. ファイルを初めて保存する場合は、文書中のテキスト1行目に基づいてファイル名が付けられ、デフォルトのファイル拡張子が付けられたファイル名がダイアログにセットされる。
4. ユーザーはダイアログ中でファイル名を自由に変更できる。
5. ユーザーはダイアログの選択肢からHTML文書タイプを選択する。これにより、動的にファイルの拡張子が.htmlに変わる。
6. ユーザーはダイアログ中でファイルを保存するディレクトリを自由に変更できる
7. ユーザーは、ソフトウェアに「文書を保存する」コマンドを完了することを指示する
8. HTML形式で保存される場合、ソフトウェアは書式情報が失われることをダイアログで表示してユーザーに警告する。保存を中止するか、続行するかの選択肢をユーザーに提示する。
9. ユーザーは、HTML形式で文書を保存することを選択する。
10. ソフトウェアは文書をファイルに保存し、新しく書式設定しなおした内容を再表示する。箇条書きやインデント、フォント設定などの特定の書式情報は、もとの書式情報から変更されることがある。


会話の例はP65参照。
ユーザーの操作に対応する、システムの責務（俺にはシステムのふるまいにも見える）の組を記述しています。

#### 詳細
実際に動作するシステムを構築する、テスト担当者がテストケースを書けるようにする、などするために会話やシナリオの記述を詳細化します。例えば以下のようなことを考えます。
* エラー処理
* デフォルト値
* システムのアクションが起こる前の確認すべき条件
* ユーザーが手順を変える可能性のある分岐点
* アルゴリズム詳細
* フィードバックのタイミングと内容
* 関連する仕様の参考文献
これらはユースケースをシンプルにするために、本文の後に付け加えると良さそう。

#### 例外
ある異常な状況と、その解決策の両方を、ユースケースに「例外」の欄を作っておいてそこにまとめる。
例：既存のファイルに対して上書き保存する場合、ユーザーに通知して既存のファイルを置き変えてよいか確認する


#### ビジネスポリシーとアプリケーションポリシー
ビジネスルールや、アプリケーションの振る舞いに対する制約は、個別にリストアップしておきます。
例：他のユーザーが開いているファイルに、ユーザーが作業内容を保存することは出来ない


#### 設計メモ
設計者にとって関心の高い条件や約束事も、ユースケースとは別で書き留めておく。
例：ファイルの拡張子の種類の例と、概要（.doc .rtf .txt .html）


### 2.2.2 その他の仕様書
例：
* 画面レイアウト
* 規約に関するドキュメント
* ポリシーに関するマニュアルの参照

などの別のドキュメントも加えるだけ加えておくと、利害関係者にとってもやさしい


### 2.2.3 用語集
設計書は一貫した用語を使うように心がけます。  
用語集を作ることで、仕様をより明確に、より一貫したものにできます。


### 2.2.4 概念オブジェクト
オブジェクト設計の最初のステップとして、ソフトウェアの中心となるオブジェクトを考える。
* 重要なドメインオブジェクト、概念。
* 複雑なアルゴリズムを実装したオブジェクト
* 技術的なインフラ
* アプリケーションが行うことを管理するオブジェクト
* 独自のユーザーインターフェースオブジェクト

例えばワープロでは、「文書」「ページ」「段落」「スペルチェッカー」などが文中で挙げられている。


## 2.3 登場人物の配役：探究的設計
概念オブジェクトと設計オブジェクトの間には隔たりがある。概念オブジェクトには多くの詳細が削られているが、設計オブジェクトは詳細についても加味していく。

### CRCカード
オブジェクトの候補やロールの候補となるものを、CRCカードに記録していく。
CRCとは、候補(Candidates)、責務(Responsibilities)、コラボレータ(Collaborators)を表す。  
カードの無地の欄には、候補の目的とロールステレオタイプ(前章参照)を形式を気にせずなんとなく書く。  
カードの罫線の欄には、責務とコラボレータを書く。

カードという形式にこだわらず、レポート用紙、ホワイトボード、付箋紙などでもおｋ


### パターンを使用して考えだす
デザインパターンの適用

例  
* 問題
* * ワープロは、ユーザーから
