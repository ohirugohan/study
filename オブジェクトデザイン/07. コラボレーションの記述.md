# 7.1 コラボレーションストーリーを伝える
オブジェクトがコラボレートする方法を説明するためには、ストーリーを語る必要がある。  
何を説明する必要があるか、相互作用がどれほど複雑であるかで、ストーリーの内容は深くも浅くもなる。

# 7.2 コラボレーションストーリーを開発するための戦略
ストーリーは、読み手が知りたいと思うことを簡単に理解できる形で表現されて、初めて意味を成す。  
たいてい複数の形式が必要になる。  

ストーリーを作成し始める前に、何を達成したいかを考える。以下、どんなコラボレーションストーリーの開発にも使える基本的な計画。
* 対象範囲、深さ、トーンを決める
* ストーリーが扱う項目を一覧にまとめる
* どの程度の詳しさで説明すべきかを決定する
* ストーリーを伝えるための適切な形式を選ぶ
* ストーリーを伝え、描き、説明する
* ストーリーを構成する
* 必要に応じで、改訂し、明確化し、拡張する。
自分が何を伝えようとしているか、伝える相手ををストーリーを作る前にまず確認。  
そして、特に強調するべき箇所を特定しておく。

# 7.3 対象範囲、深さ、トーンを決める
ストーリーを語る場合、どれほどの大きさの領域を対象にするかは、目的によって変わる。
たいてい、ストーリーは知識を伝えるか反応を得るかを目的にし、手早く説明される。  
説明は意識的に大雑把なものにする。

# 7.4 対象とするものを一覧にまとめる
ストーリーが広い範囲を対象にするならば、伝えるべきことは多くありますが、
まず頭に浮かんだすべてのことを一覧に揚げつつ、主要なポイントが何であるかを考える。  
ストーリーを書き終えるまでは提示するまでの良い手段が不明なので、  
ストーリーの大部分を書き終えるまではストーリーや一覧上の項目をどのように構成するかは考えない。

# 7.5 ストーリーの詳しさを決定する
コラボレーションを捉える視点にはいくつかあるので、示していく

## (全体的なアーキテクチャと一般的なコラボレーションの経路を示す、システムコンポーネントとサブシステムに対する)鳥瞰的な視点
システムがどのようにサブシステムで構成されるかを示し、それらのサブシステム間のコラボレーションを図示する。  
個々のオブジェクト間のコラボレーションは意識しない。  
どのくらい厳密に説明するか
* 一般的ンナコラボレーションの経路
* 各サブシステムのインターフェースがサポートする操作の列挙

## あるコラボレーションに関与するオブジェクトだけを示す視点
CRCカードを使って、高いレベルでコラボレートションを記述する。(またはUMLのコラボレーション図)  
コラボレーションするオブジェクト間に線(リンクと呼ぶ)を引く。  
リンクに矢じりを補足し、参照可能性を示す
CRCカードには、オブジェクト名の他に、ロールも書いておく。厳密にするならクラス名を書いておいても良い。  
P288,289を参照

## コラボレータ間の相互作用の順序の視点
コラボレーション図に、メッセージの順序を示す数を加えたり、メッセージの流れを示す矢印線を加えたりすることで表現可能。詳しくはP291。  
他にも、シーケンス図が使用可能。こちらもP291

## オブジェクトの詳細への視点
1つの相互作用の中で、分岐、オブジェクトの生成削除、繰り返し、非同期通信、アクティブオブジェクト、再帰なども表現可能。  
相互作用が複雑な判断を含む場合、代替パスを説明するための表記を用いてシーケンス図で図示可能(P292図)（？）  
実行するタイミングに制約がある場合は、それもシーケンス図で記述可能。P293図参照  
並行性があるアプリケーションには、制御フローが複数ある。複数の相互作用の流れが、論理的には同時に発生しうる時もある。  
アクティブオブジェクト、非同期メッセージ、ブロードキャストメッセージの3要素を使って、シーケンス図で表現可能。(P294)  

## 焦点を絞って相互作用を示す
システムの一部をブラックボックス化するような場合は、そこの部分に焦点を当てて相互作用を説明する。  
焦点を充てる部分以外は、説明を抽象化したり省略する。  
例えば、ユーザーがボタンをクリックした後に何が起こるかを説明する場合、保存ボタンについての詳細な説明は要らない。  
「保存ボタンを押す」ではなく、「文書を保存する」でいい。

## 実装の焦点を示す
既にコーディングしたものを文書化する場合、その文書が提案中のものではなく既に動作しているものであることを、明確にラベリングする。  
図や文書はコードほど正確ではないので。
そして、メッセージのシグニチャ、重要な戻り値、分岐、相互作用という具体的な情報をきちんと盛り込む。  
ただし、全てを表現するのではなく、強調したいものをきちんと強調する。

## コラボレーションを適応させる方法を、一般的に伝えるための視点
適応：「後からコラボレータを追加したり入れ替えたりしても、問題無く動作すること」？  
「後からカスタマイズ可能であること」？  
  
あるコラボレータを別のコラボレータと入れ替えたり、特定の条件やパラメータを設定したり、既存のオブジェクトを保管する新しいオブジェクトを組み込むためには、  
現在の設計がどのように動作しているか、どの部分が後からいじれるのか、どのようにいじるのか、の3つを説明する必要がある。  

コラボレーション図に、新しいコラボレータが組み込まれる可能性のある場所に印をつける(P297)

コラボレートするロールのパターンを作り上げた場合(?)  
このようなコラボレーションは、入れ替えするのではなく、採用(インスタンス化)しなければならない(?)  

パターンの各ロールを果たすオブジェクト群の設計をする。  
コラボレーションと呼ばれているUML表記を使う。コラボレーションに名前をつけ、それぞれの参加者オブジェクトに向かって点線を描き、点線にロール名を付ける。

## UML図では不十分な場合
複雑なアルゴリズムを考える。  
バブルソートについてのシーケンス図を見ると、アルゴリズムの重要な側面を見分けたり、アルゴリズムが確かに進行していることを理解することすら困難。  
アルゴリズムについての詳細は、以下の様な表現方法を複数使って表現する
* テキスト
* アルゴリズムの動作を可視化
* いっそのことコードを書く（実際のコードまたは擬似的なコード）
* BNF文法
* 状態マシン図
* 決定表
* その他あるとわかりやすい図

シーケンス図を書くと、シーケンス図内の全てのメッセージが同じくらい重要に思えてきてしまう側面がある。  
何らかの方法で強調しないと、特別なものには見えない。  
例外についての説明は、無理にシーケンス図で説明するのではなく、別途表を作ると良い。(P303)

# 7.6 適切な形式を選ぶ
イラスト、グラフ、説明書き、表、CRCカード、など様々なストーリーの表現方法があるので、  
1番伝えたいことを明確にした上で、表現方法を選ぶ。  
おおまかなガイドラインはP304の表にある。

# 7.7 伝える、描く、記述する：ガイドライン
以下、コラボレーションを記述するためのガイドライン

## 書き過ぎないようにする
読み手の求めるレベルの詳しさで図や文章を書く。  
書きすぎると、読み手の集中力が続かない。

## 必要のない文章を省く。
意味や定義を説明しなくてはいけないような言葉は使わない。簡単な言葉を使う。  
文章だけでなく、図にも不要な要素はたくさんある。例えば
* 送信メッセージから返された値
* 内部的なアルゴリズムの詳細
* キャッシュ処理や遅延初期化の詳細
* オブジェクトの生成と破棄
実装上の詳細は、基本的には描写しない。

## 修正し書き直す
読み手が理解できなかったら書き直す。  
読み手によって求めるものが違うのであれば、複数のバージョンを作ってみる。  
図が複雑になり過ぎたなら、その図をより小さな下位の図に分割できる。  
先が繋がっていない矢印を書き、矢印の先を別の図にして、詳細を分割させるテクニックもアリ。(P308)
詳細が足りなかったのであれば、低いレベルのコラボレータやメッセージなど書くのでなく、注釈をつけて補足する。

## 不確かなままで放置しない
めんどくさがらない。  
説明したい詳細はきちんと説明する。  
冗長になるのが心配なら、少しでも異なった方法で繰り返し述べることで強調可能。はっきりと詳しく説明してから、要約する。  
まず書き留めて、その後それをどうやって表現するか考える。

## 明確にする
重要なものを強調する
* メッセージの順序を強調 → シーケンス図を使う
* コラボレータ図で重要なオブジェクトを強調 → 中央に配置する
など。
あとは、レイヤ図を使うことで、コミュニケーションパターンがレイヤ化されていることを示したり、  
読みやすくするためにオブジェクトの数を絞る、など。

## 1つの声で話そう（重要！！！）
ストーリーを表現する時は、1つの視点で話す。  
例えば、サブシステム間のコラボレートについて話している時に、サブシステム内のオブジェクトと標準ライブラリのオブジェクトとコラボレートしていることについて間に挟む、など。  
説明のために詳細を伝えなければならない時も、ストーリーと関係のない詳細まで踏み込まない。  
ストーリーと関係の無いメモ書きは、本当に伝えたいことの2%以下にする。（書くな、ということ。）

# 7.8 説明内容を構成する

## 強調する
ストーリーの特定の部分を強調するための方法
* 重要な事柄を最初に置き、読み手を方向づける。
* 重要な事柄を強調表示する
* テキストの回りに空白を設ける
* 重要な事柄にはより大きなスペースを与える。（説明を長くする）
* 重要な事柄を中心に置く
* 箇条書きで書く
* 重要な事柄を何度も言及する
* 異なる形式で言い換える
 
## ストーリーを展開する
一気に全て説明しようとせず、  
少しずつストーリーの段階を踏んで、目指している目的地へ誘導する。  
それぞれの段階で、新たな驚きを含ませる。  

どんな構成が良いか。
1. 読み手の興味を引く見出しをつける
2. 最初に基本的なことを説明する。登場人物、登場人物において何が重要か、登場人物のコラボレーションはどのように動作するか
3. 概要の後に、詳細を示す

## 何が基本的なものかを理解する
ある語句を最初に説明してから詳細に入る、という方法は難しい。興味や勢いを生み出すようにストーリーを説明する。  
読み手の興味と背景は様々に異なるので、基本的なことを説明するかどうかを選ぶ必要がある。  
そも、基本的なこととは。
* 設計者が変えることの出来ない前提。例えば、ユースケースそれそのものは、それを図示するコラボレーション図より基本的なものである。
* オブジェクトの関係・属性・アクションより、オブジェクトそのもののほうが基本的
* 正常なケースは、例外的なケースより基本的。

## ストーリーを1つにまとめる
新しいものが既知のものと十分に異なる場合は、関心をもたれやすい。  
単調になっていないかを意識する。何らかの詳細を明示的に強調する、次の図と異なる天を説明する、どうしても同じような図が連続する場合にそれを説明してチラ見程度で済ませてもらう、など。  
特定の情報が欲しい人向けには、索引やFAQを付ける、など。

# 7.9 ストーリーを保存する
コードをリリースした後でも、ストーリーを保存する意味
* 他の人が、設計を壊すような変更を後にしないようにするため
* コードから推測できないことを伝える

コーディングし直す度にドキュメントを更新したくないが、かといって救いようのないほどに古いものにしないために
設計をかなり見なおした時のみ、必ずコラボレーションストーリーを更新する、ようにする。  
複数のオブジェクトが行うことの調整や、新しく考えられたオブジェクトがストーリーの中心になった時、など。  
メッセージや引数の1つを変更する、くらいなら小さい見直しとする。


# 7.10 まとめ
* ストーリーを作るケースによって、作るドキュメントも変わる
* 何を強調したいかを考え、かつ、全体を簡潔にまとめる
* UMLは様々な詳しさでコラボレーションを説明できるが、正解が図とは限らない。適切な表現方法を選ぶ。
* 設計記録の一部として、重要なコラボレーションストーリーを長期的に保存する。設計をかなり見なおした時はストーリーを更新する。
