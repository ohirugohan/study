# オブジェクトの網の目
巨大なシステムを構築する際は、モジュールの内部の性質や振る舞いがどうあるべきかより、モジュールがどうコミュニケーションするかを設計するほうがはるかに重要。  
システムを構築する際は、オブジェクトを作成してそれらを結びつけ、お互いにメッセージを送信できるようにする。  
システムの振る舞いは、オブジェクトの組み合わせから現れる性質である。

システムの振る舞いを変更するには、オブジェクト同士の組み合わせを変更すれば良くなる。  
インスタンスを追加・削除したり、他の組み合わせにつなげる、など。  

# "値"と"オブジェクト"
値：変化しない量をモデル化した、不変のインスタンス。状態が同じインスタンスは事実上同一のもの。
オブジェクト：状態が変化する。処理プロセスをモデル化している。ある時点で全く同じ状態であっても、将来的に異なる状態になりうる。アイデンティティを持っている。  
この2つは、クラスで構成することが可能だが、この2つの概念はきちんと区別するべきである。

# メッセージに従うこと
コミュニケーションパターン：オブジェクトの集団が互いにどう通信するかを定めたルールの集まり。  
具体的には、オブジェクトのロールや、どのようなメッセージをいつ送信できるか、など。

ドメインモデルは、このようなコミュニケーションパターンの中に存在する。コミュニケーションパターンが、オブジェクト間で生じ得る関係性という領域に意味を与えるからである。  
オブジェクト間のコミュニケーションをより明確に見えるようにする上で、テストやモックオブジェクトは非常に役に立つ。

P.17後半から出てくるビデオゲームの例では、ビデオゲームのオブジェクトの実装を例に、  
コミュニケーションパターンの設計を、ゲームエンジンからの視点と、動作しているオブジェクトの実装の視点の2つを紹介している。  
(後者の視点で視たオブジェクトは良い例なのか？)

# 命じよ、尋ねるな
複数のオブジェクトが互いにメッセージを送りあっている際、  
呼び出し元のオブジェクトは、呼び出し先のオブジェクトが演じているロールの観点から、何をして欲しいかを記述しなくてはならない。  
そして、どうやってそのようにするかは、全てオブジェクトに任せる。  
オブジェクトが意思決定を行う際には、自信が内部に持っている情報かトリガとなるメッセージとともに渡される情報だけを基にする。他のオブジェクトを操って何かをする、というようなことはしない。  
悪い例のコードがP.19下方にある。このコードの大きな欠点は、設計上の1つの変更が大規模な変更を起こしかねないことである。

# しかし、時には尋ねることもある
値やコレクションから情報を取り出す時や、新しいオブジェクトを生成するためにファクトリを使うときには、「尋ねる」ことになる。  
が、尋ねる時は本当に欲しい答えが得られるような質問をすべき。

P.20の例では、列車オブジェクトが内部に持っている車両オブジェクトに対して、座席の予約ができるかの判定をしている。  
悪い例では、車両オブジェクトが持っている座席オブジェクトを呼び出し、その座席オブジェクトの予約率が閾値より低いかを、列車側で判断し、予約の可否を決定している。  
良い例では、車両オブジェクトに閾値を渡し、その車両で予約ができるかを判定することを命じている。このためのメソッドを追加している。

オブジェクトに対する問い合わせを減らすことで、オブジェクトから隠ぺいするべき情報が漏れないようにする。  

# 協力しあうオブジェクトのユニットテスト
テスト対象オブジェクトの隣接オブジェクトの内部状態を露呈させること無くテストを書く際、  
この隣接オブジェクトを、モックオブジェクトに代用品として置き換える。  
起点となるイベントに対し、テスト対象のオブジェクトがどのように隣接モックとコミュニケーションするかについて、自分たちが期待する内容を定義する。  
この定義のことを、エクスペクテーションと呼ぶ。

ポイントは、
* テスト対象のオブジェクトだけをテストしたい、ということ。
* 隣接するオブジェクトがどのようなものであるかが既に分かっている。
    * テストを書く時は、隣接オブジェクトは存在しなくても構わない。
テストを書くことで、隣接オブジェクトに必要なロールが明らかになり、このクラスを開発し終えた後で開発することになる。

# モックオブジェクトを用いてTDDをサポートする
テスト記述の本質的な構造は次のようになる
* テストに必要なモックオブジェクトを生成する
* テスト対象オブジェクトを含む、実際のオブジェクトを生成する
* モックオブジェクトに、テスト対象オブジェクトからどう呼び出されるかのエクスペクテーションを定義する
* テスト対象オブジェクトのメソッドを呼び出す
* 結果として生じる値が全て正しいことと、期待された呼び出しが全て行われていることをアサートする
ユニットテストをこのように書くことで、テスト対象オブジェクトと隣接オブジェクト達との関係を明示できる。
