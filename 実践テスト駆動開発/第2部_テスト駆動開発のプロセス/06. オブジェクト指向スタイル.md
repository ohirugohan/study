この章では、設計のゴールやTDDの使い方について詳細に見る。特に、モックオブジェクトの使い方に焦点を合わせる。  

# 保守を考えて設計する
機能を構造化して、オブジェクト化、オブジェクトをパッケージ化、パッケージをプログラム化、プログラムをシステム化、などとする。  
この構造化を行うために、次の2つの原則を用いる。

## 感心事を分離する
システムの振る舞いを変更する時は、変更するコードの量はできるだけ少なくしたい。  
そのために、同じ理由で変更することになるであろうコードはまとめておく。  

## 抽象度を高める
複雑さに対処するために、より高い抽象度で作業し、できるだけシンプルにとらえる。  
プログラムを作る時は、中のアルゴリズムを操作するのだけでなく、役に立つ機能のコンポーネントを組み合わせるようにする。

この2つを一貫して適用することで、ビジネスドメインのコードが、DBやUIといった技術基盤との依存関係から切り離される。  
技術的概念がアプリケーションモデルに流出するのを避けるため、インターフェイスを書き、外部との世界との関係をアプリケーションの用語に従って説明する。(ポート)  
その上で、アプリケーションの中核と、各技術ドメインとの間に置かれるブリッジを書く。(アダプタ)

ブリッジは、アプリケーションモデルによって定義されるインターフェイスと、アプリケーションに関連するオブジェクトと技術に関連するオブジェクト間の紐付けを実装する。

# 内部構造 vs ピア
システムを組み上げていく際には、各オブジェクトについて何が内部で何が外部なのかを決めていく。  
オブジェクトにおける重要ポイントは、内部に対するアクセスをカプセル化することと、詳細をシステムの他の部分から隠ぺいすることにある。

カプセル化をきちんと行わないと、本来そのオブジェクトがやる仕事をクライアントがやることになってしまったり、多くのオブジェクトに振る舞いを分散させてしまうことになる。  
こうなると保守のコストも上がる。

# ANDやOR、BUTは禁止
あらゆるオブジェクトは、明確に定義された責務を一つだけ持つべき。  
オブジェクトが何をしているかを説明するときに「AをしてBをする」などとandやorの接続詞を使ったら、そのオブジェクトは協力しあう複数のオブジェクトに分解するのが良い。

# オブジェクトピアのステレオタイプ
オブジェクトのピア(メッセージを贈り合う相手)との関係性を大まかに3つに分ける

## 依存
あるオブジェクトが自身の責務を果たすために、ピアに対して要求する。ピアがなければオブジェクトは機能できない。  
このようなオブジェクトは、依存するサービスがなければ生成できないようにしたい。

## 通知
特定のオブジェクトが状態変更や重要なアクションを行った時などに、そのオブジェクトの最新情報を取得し続けるピア。  
オブジェクトとピアは疎結合である。つまり、オブジェクトはピアに対して通知は行うが、オブジェクトはピアが何をするものかは知らないし、ピアもオブジェクトの内部詳細については知らない。

## 調整
オブジェクトの振る舞いを調整するピア。オブジェクトの代わりに意思決定を行うポリシーオブジェクトも含まれる。

重要なのは協力しあうオブジェクトが使われるコンテキスト。  
ログを監査する機能は、あるアプリケーションでは依存かもしれないし、あるアプリケーションでは通知かもしれない。

# コンポジットは構成要素の総体よりもシンプルにせよ
オブジェクトは、プリミティブ型を除いて、全てが複数の他のオブジェクトで構成されている。  
複数のオブジェクトを組み合わせて新しい型を作る時、構成要素を全て一緒に考えるよりもシンプルな振る舞いを示すようにするべき。  
オブジェクトの内部構造を露わにせず、適切にカプセル化し、シンプルな抽象を見せる。

# コンテキストからの独立
オブジェクトが情報を隠蔽しすぎてないか、間違った情報を隠蔽していないか、判断する。

オブジェクトがコンテキストから独立している、つまり、オブジェクトにそれを実行するシステム固有の知識が無い状態、であると、  
システムの変更が容易になる。
このルールを適用することで、オブジェクトはシンプルになり、自身の関係性の管理がシンプルになる。  
また、さまざまなコンテキストに配置可能なオブジェクトとなり、  
こうしたオブジェクトでシステムを構成することで、システム変更が容易になる。

# 適切な情報を隠ぺいする
「アプリケーションのログファイルの名称を、PricingPolicyクラスに隠ぺいする」
コンテキストから独立している、ということは、PricingPolicyクラス内のログファイルには、ビジネスに関する詳細な情報が一切隠されていない、ということ。  
ビジネスに関する詳細な情報は、別の抽象度に由来している。ログファイルの名称が必要なら、外部設定を理解してまとめているオブジェクトから渡されるべき。
